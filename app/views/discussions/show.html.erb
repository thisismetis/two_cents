<script type="text/javascript">
  var pusher = new Pusher('<%= ENV.fetch('PUSHER_KEY') %>');
  var channel = pusher.subscribe('comments_updater');
  channel.bind('discussion_<%= @discussion.token %>', function(comment) {
    template = "\<span class='comment-author'\>"
    template += comment.username;
    template += " said: ";
    template += "\<\/span\>"
    template += comment.body;
    template += " ";
    template += moment(comment.created_at).fromNow();
    template += "\<br\>"
    $("#comments").append(template);
  });
</script>

<div id="discussion-name">
  <h2><%= @discussion.name %></h2>
</div>

<div id="content-wrapper">
  <%= render @discussion.content %>
</div>

<div id="comments-wrapper">
  <div id="comments">
    <%= render @comments %>
  </div>
  <% if @discussion.open? %>
    <%= render 'comment_form' %>
  <% end %>
</div>
